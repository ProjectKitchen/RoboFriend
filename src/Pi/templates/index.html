<!DOCTYPE html>
<html>
<head>
  <title>Robot Cam</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<style>
table, td, tr {
    width: 30%;
}
</style>

<script language="javascript">
    /*var url_string = "http://www.example.com/t.html?a=1&b=3&c=m2-m3-m4-m5"; //window.location.href
    var url = new URL(window.location.href);
    var custom = url.searchParams ? url.searchParams.get("c") : null;*/

    window.const = {};
    //window.const.hostname = '192.168.0.100';
    window.const.hostname = window.location.hostname;
    window.const.RESTbaseUrl = "http://" + window.const.hostname + ":8765/";
    function loadUrl() {
        var url = "http://" + window.const.hostname + ":8080/?action=stream";
        document.getElementById("webcam").setAttribute("src", url);
    }

    function sendHttpPost(restPath, successCallback, errorCallback) {
        var url = window.const.RESTbaseUrl + restPath;
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.onreadystatechange = function() {
            if (xmlHttp.readyState === 4) {
                if (xmlHttp.status === 200) {
                    if(successCallback) successCallback(xmlHttp.responseText);
                } else {
                    if(errorCallback) errorCallback();
                }
            }
        };
        xmlHttp.open("POST", url);
        xmlHttp.send();
    }

    function hexToRgb(hex) {
        var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
        return result ? {
            r: parseInt(result[1], 16),
            g: parseInt(result[2], 16),
            b: parseInt(result[3], 16)
        } : null;
    }

    function colorChanged(value) {
        var rgb = hexToRgb(value);
        sendHttpPost('ear/color/' + rgb.r + '/' + rgb.g + '/' + rgb.b)
    }
</script>

<body onload="loadUrl();">
<table style="width:100%; max-width: 500px; height:300px;">
  <tr>
    <td>&nbsp;</td>
    <td>
        <input type="image" onclick="sendHttpPost('move%3Bforward%3Bstep')" name="direction" src="/static/img/forward.svg" value="forward" style="float:left; width:80%;">
        </br>
    </td>
    <td>&nbsp;</td>
    <td>
        <button type="submit" onclick="sendHttpPost('sound%3Bplay%3Bdata%252F%3Bmood')" name="sound"> Mood Sound </button>
        </br>
        <button type="submit" onclick="sendHttpPost('sound%3Bplay%3Bdata%252Ffabibox%252F%3Brandom')" name="sound2"> Random Sound </button>
        </br>
    </td>
	<td>
		<p> Akku:{{ battery }} %</p>
	</td>
  </tr>
  <tr>
    <td>
        <input type="image" onclick="sendHttpPost('move%3Bleft%3Bstep')" name="direction" src="/static/img/left.svg" value="left" style="float:left; width:80%;">
        </br>
    </td>
    <td>
<!--      <form action="/5" method="POST">
        <input type="image" name="direction" src="/static/img/stop.svg" value="stop" style="float:left; width:80%;">
        </br>
      </form>-->
    </td>
    <td>
        <input type="image" onclick="sendHttpPost('move%3Bright%3Bstep')" name="direction" src="/static/img/right.svg" value="right" style="float:left; width:80%;">
        </br>
    </td>
<!--    <td>
      <form method="POST">
        <button type="submit" name="sound2" value="/6"> Sound 2 </button>
        </br>
      </form>
    </td>-->
  </tr>
  <tr>
    <td>&nbsp;</td>
    <td>
        <input type="image" onclick="sendHttpPost('move%3Bbackward%3Bstep')" name="direction" src="/static/img/reverse.svg" value="reverse" style="float:left; width:80%;">
        </br>
    </td>
    <td>&nbsp;</td>
  </tr>
</table>
<img id="webcam" style="width:100%; max-width: 600px; max-height:600px; border-radius:10px" />
</br>
<button type="submit" onclick="sendHttpPost('camera/up')" name="camUp"> Camera UP </button>
<button type="submit" onclick="sendHttpPost('camera/down')" name="camDown"> Camera DOWN </button>
</br>
<button type="submit" onclick="sendHttpPost('say%3Bhello')" name="speech"> Say Hello </button>
<button type="submit" onclick="sendHttpPost('say%3BI like you')" name="speech"> Say I like you </button>
<button type="submit" onclick="sendHttpPost('say%3BYou look funny')" name="speech"> You look funny </button>
</br>
<button type="submit" onclick="sendHttpPost('face%3Bsmile%3Bincrease')" name="smileMore"> Smile more </button>
<button type="submit" onclick="sendHttpPost('face%3Bsmile%3Bdecrease')" name="smileLess"> Smile less </button>
</br>
<button type="submit" onclick="sendHttpPost('face%3Beyes%3Bup')" name="lookUp"> Look up </button>
<button type="submit" onclick="sendHttpPost('face%3Beyes%3Bdown')" name="lookDown"> Look down </button>
<button type="submit" onclick="sendHttpPost('face%3Beyes%3Bleft')" name="lookLeft"> Look left </button>
<button type="submit" onclick="sendHttpPost('face%3Beyes%3Bright')" name="lookRight"> Look right </button>
<br>
<label for="colorPicker">Choose ear color: </label>
<input id="colorPicker" type="color" onchange="colorChanged(this.value)"/>
</br>
</body>
</html>
