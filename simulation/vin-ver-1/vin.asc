Version 4
SHEET 1 2260 1148
WIRE 256 -896 256 -944
WIRE 256 -896 112 -896
WIRE 112 -864 112 -896
WIRE 256 -800 256 -896
WIRE 336 -800 256 -800
WIRE 256 -768 256 -800
WIRE 112 -752 112 -784
WIRE 208 -752 112 -752
WIRE 336 -752 336 -800
WIRE 112 -704 112 -752
WIRE -80 -656 -96 -656
WIRE 16 -656 0 -656
WIRE 48 -656 16 -656
WIRE 256 -640 256 -672
WIRE 336 -640 336 -688
WIRE 336 -640 256 -640
WIRE 16 -624 16 -656
WIRE -1008 -592 -1008 -608
WIRE -928 -592 -928 -608
WIRE -832 -592 -832 -608
WIRE -736 -592 -736 -608
WIRE -640 -592 -640 -608
WIRE 256 -560 256 -640
WIRE 320 -560 256 -560
WIRE 464 -560 400 -560
WIRE 544 -560 496 -560
WIRE 672 -560 624 -560
WIRE 16 -528 16 -544
WIRE 112 -528 112 -608
WIRE 112 -528 16 -528
WIRE 256 -528 256 -560
WIRE -1008 -496 -1008 -512
WIRE -928 -496 -928 -512
WIRE -832 -496 -832 -512
WIRE -736 -496 -736 -512
WIRE -640 -496 -640 -512
WIRE 112 -480 112 -528
WIRE 560 -464 560 -496
WIRE 496 -448 496 -560
WIRE 496 -448 432 -448
WIRE 528 -448 496 -448
WIRE 672 -432 672 -560
WIRE 672 -432 592 -432
WIRE 752 -432 672 -432
WIRE 256 -416 256 -448
WIRE 256 -416 112 -416
WIRE 320 -416 256 -416
WIRE 432 -416 432 -448
WIRE 432 -416 400 -416
WIRE 464 -416 464 -560
WIRE 528 -416 464 -416
WIRE 848 -416 816 -416
WIRE 112 -400 112 -416
WIRE 752 -400 720 -400
WIRE 560 -368 560 -400
WIRE 784 -368 784 -384
WIRE 256 -352 256 -416
WIRE 464 -352 464 -416
WIRE 720 -304 720 -400
WIRE 720 -304 704 -304
WIRE 112 -240 112 -256
WIRE 256 -240 256 -272
WIRE 464 -240 464 -272
WIRE 672 -240 672 -272
WIRE -864 16 -1008 16
WIRE -624 16 -720 16
WIRE -592 16 -624 16
WIRE -480 16 -512 16
WIRE -384 16 -480 16
WIRE -240 16 -384 16
WIRE -96 16 -240 16
WIRE 48 16 -96 16
WIRE 192 16 48 16
WIRE 336 16 192 16
WIRE 512 16 384 16
WIRE -1008 48 -1008 16
WIRE -864 48 -864 16
WIRE -384 48 -384 16
WIRE -240 48 -240 16
WIRE 192 48 192 16
WIRE 992 48 960 48
WIRE 1104 48 1072 48
WIRE 1248 48 1168 48
WIRE 48 64 48 16
WIRE 384 64 384 16
WIRE -576 80 -576 64
WIRE -528 80 -528 64
WIRE 336 80 336 16
WIRE -384 176 -384 128
WIRE -240 176 -240 112
WIRE -240 176 -384 176
WIRE 48 176 48 128
WIRE 192 176 192 128
WIRE 192 176 48 176
WIRE 336 176 336 128
WIRE 336 176 192 176
WIRE 384 176 384 144
WIRE 512 176 384 176
WIRE -1008 192 -1008 128
WIRE -864 192 -864 128
WIRE -720 192 -720 16
WIRE 48 208 48 176
WIRE -240 224 -240 176
WIRE 192 224 192 176
WIRE -96 240 -96 16
WIRE -384 288 -384 176
WIRE 0 288 -64 288
WIRE 736 288 704 288
WIRE 864 288 816 288
WIRE 1008 288 864 288
WIRE 1152 288 1008 288
WIRE 1232 288 1152 288
WIRE 864 320 864 288
WIRE 1008 320 1008 288
WIRE 1152 320 1152 288
WIRE -1008 336 -1008 272
WIRE -864 336 -864 272
WIRE -864 336 -1008 336
WIRE -720 336 -720 272
WIRE -512 336 -720 336
WIRE -464 336 -512 336
WIRE -320 336 -368 336
WIRE -240 336 -240 288
WIRE -240 336 -320 336
WIRE -96 336 -96 320
WIRE -96 336 -240 336
WIRE 48 336 48 304
WIRE 48 336 -96 336
WIRE 192 336 192 288
WIRE 192 336 48 336
WIRE -1008 368 -1008 336
WIRE -720 368 -720 336
WIRE -512 416 -512 336
WIRE -448 416 -512 416
WIRE -320 416 -320 336
WIRE -320 416 -384 416
WIRE 864 432 864 400
WIRE 864 432 704 432
WIRE 1008 432 1008 384
WIRE 1008 432 864 432
WIRE 1152 432 1152 384
WIRE 1152 432 1008 432
WIRE 704 448 704 432
FLAG -1008 368 0
FLAG 1248 48 0
FLAG -624 16 Vbat
FLAG -480 16 Vload
FLAG 960 48 Vload
FLAG 704 288 Vload
FLAG 704 448 0
FLAG 1232 288 ADC
FLAG 512 16 Vload
FLAG 512 176 Buck
FLAG -928 -496 0
FLAG -928 -608 SW
FLAG -576 80 SW
FLAG -528 80 0
FLAG -832 -608 12V
FLAG -832 -496 0
FLAG -736 -608 5V
FLAG -736 -496 0
FLAG 464 -240 0
FLAG 560 -368 0
FLAG 256 -240 0
FLAG -1008 -496 0
FLAG -1008 -608 OC
FLAG 256 -944 Vload
FLAG 112 -240 0
FLAG 560 -496 5V
FLAG 784 -448 5V
FLAG 784 -368 0
FLAG 672 -240 0
FLAG 672 -352 5V
FLAG 848 -416 \OC_INT
FLAG 112 -480 0
FLAG -96 -656 OC
FLAG -640 -608 3.3V
FLAG -640 -496 0
FLAG -720 368 0
SYMBOL Misc\\EuropeanResistor -992 144 R180
WINDOW 0 31 76 Left 2
WINDOW 3 31 40 Left 2
SYMATTR InstName R1
SYMATTR Value 47
SYMBOL Misc\\EuropeanResistor -848 144 R180
WINDOW 0 31 76 Left 2
WINDOW 3 31 40 Left 2
SYMATTR InstName R3
SYMATTR Value 47
SYMBOL sw 384 160 M180
SYMATTR InstName S1
SYMATTR Value DPST
SYMBOL Misc\\EuropeanResistor 976 64 R270
WINDOW 0 27 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName R7
SYMATTR Value 1k
SYMBOL LED 1104 64 R270
WINDOW 0 72 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D1
SYMBOL nmos 0 208 R0
SYMATTR InstName M1
SYMATTR Value IRF3717
SYMBOL diode 208 288 R180
WINDOW 0 -44 31 Left 2
WINDOW 3 -87 -2 Left 2
SYMATTR InstName D2
SYMATTR Value 1N4148
SYMATTR Description Schottky diode
SYMATTR Type schottky
SYMBOL diode 64 128 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D3
SYMATTR Value 1N4148
SYMBOL pot -112 224 R0
SYMATTR InstName X2
SYMATTR SpiceLine R=10k Val=72.5
SYMBOL Misc\\EuropeanResistor 176 32 R0
SYMATTR InstName R6
SYMATTR Value 1k
SYMBOL voltage -720 176 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -193 336 Left 2
SYMATTR Value PULSE(0 12V 1s 1ms 1ms 2s 3s 5)
SYMATTR InstName V1
SYMBOL voltage -864 176 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 244 291 Right 2
SYMATTR Value PULSE(0 12V 1s 1ms 1ms 2s 3s 5)
SYMATTR InstName V2
SYMBOL voltage -1008 176 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -6 245 Left 2
SYMATTR Value PULSE(0 12V 1s 1ms 1ms 2s 3s 5)
SYMATTR InstName V3
SYMBOL nmos -464 288 M90
WINDOW 0 -18 50 VLeft 2
WINDOW 3 72 121 VLeft 2
SYMATTR InstName M2
SYMATTR Value IPB009N03L
SYMBOL Misc\\EuropeanResistor -400 32 R0
SYMATTR InstName R2
SYMATTR Value 12k
SYMBOL zener -224 288 R180
WINDOW 0 24 64 Left 2
WINDOW 3 -50 0 Left 2
SYMATTR InstName D4
SYMATTR Value DMZ8551
SYMBOL cap -256 48 R0
SYMATTR InstName C1
SYMATTR Value 15n
SYMATTR SpiceLine V=50V
SYMBOL Misc\\EuropeanResistor 720 304 R270
WINDOW 0 27 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName R5
SYMATTR Value 100k
SYMBOL Misc\\EuropeanResistor 848 304 R0
SYMATTR InstName R8
SYMATTR Value 27k
SYMBOL cap 992 320 R0
WINDOW 0 -43 22 Left 2
WINDOW 3 -45 60 Left 2
SYMATTR InstName C2
SYMATTR Value 100n
SYMBOL zener 1168 384 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D9
SYMATTR Value DMZ8551
SYMBOL diode -384 400 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D5
SYMATTR Value 1N4148
SYMATTR Description Schottky diode
SYMATTR Type schottky
SYMBOL voltage -928 -608 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -8 218 Left 2
SYMATTR Value PULSE(0V 5.1V 2s 1m 1m 6s 8s 1)
SYMATTR InstName V4
SYMBOL sw -496 16 M270
WINDOW 0 41 29 Left 2
WINDOW 3 39 75 Left 2
SYMATTR InstName S2
SYMATTR Value BTN
SYMBOL voltage -832 -608 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V5
SYMATTR Value 12V
SYMBOL voltage -736 -608 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V6
SYMATTR Value 5V
SYMBOL Misc\\EuropeanResistor 240 -544 R0
SYMATTR InstName R10
SYMATTR Value 0.01
SYMBOL Misc\\EuropeanResistor 304 -544 R270
WINDOW 0 27 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName R11
SYMATTR Value 1k
SYMBOL Misc\\EuropeanResistor 304 -400 R270
WINDOW 0 27 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName R12
SYMATTR Value 1k
SYMBOL Misc\\EuropeanResistor 448 -368 R0
SYMATTR InstName R13
SYMATTR Value 33k
SYMBOL Misc\\EuropeanResistor 528 -544 R270
WINDOW 0 29 26 VTop 2
WINDOW 3 57 95 VBottom 2
SYMATTR InstName R14
SYMATTR Value 33k
SYMBOL voltage -1008 -608 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -18 171 Left 2
SYMATTR Value PULSE(0V 5V 2s 1m 1m 6s 8s 1)
SYMATTR InstName V7
SYMBOL Misc\\EuropeanResistor 96 -416 R0
WINDOW 0 -47 42 Left 2
WINDOW 3 -32 70 Left 2
SYMATTR InstName R15
SYMATTR Value 1k
SYMBOL LED 96 -320 R0
WINDOW 0 -41 24 Left 2
WINDOW 3 -43 50 Left 2
SYMATTR InstName D6
SYMBOL Opamps\\UniversalOpamp2 560 -432 R0
SYMATTR InstName U1
SYMBOL Opamps\\UniversalOpamp2 784 -416 R0
SYMATTR InstName U2
SYMBOL pot 656 -368 R0
WINDOW 0 -34 77 Left 2
SYMATTR InstName X1
SYMATTR SpiceLine R=10k Val=35
SYMBOL Misc\\EuropeanResistor 16 -672 R90
WINDOW 0 5 56 VBottom 2
WINDOW 3 27 56 VTop 2
SYMATTR InstName R17
SYMATTR Value 1k
SYMBOL diode 352 -688 R180
WINDOW 0 -22 61 Left 2
WINDOW 3 -75 2 Left 2
SYMATTR InstName D7
SYMATTR Value 1N4148
SYMATTR Description Schottky diode
SYMATTR Type schottky
SYMBOL Misc\\EuropeanResistor 96 -880 R0
SYMATTR InstName R9
SYMATTR Value 1k
SYMBOL pmos 208 -672 M180
WINDOW 0 -33 49 Left 2
WINDOW 3 75 -3 VRight 2
SYMATTR InstName M3
SYMATTR Value FDS6576
SYMBOL npn 48 -704 R0
SYMATTR InstName Q1
SYMATTR Value 2N4124
SYMBOL Misc\\EuropeanResistor 0 -640 R0
SYMATTR InstName R16
SYMATTR Value 10k
SYMBOL voltage -640 -608 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V8
SYMATTR Value 3.3V
SYMBOL Misc\\EuropeanResistor 240 -368 R0
SYMATTR InstName R18
SYMATTR Value 12
TEXT -1096 -272 Left 2 !.tran 0 15s 0 100m
TEXT -1096 -240 Left 2 !.model DPST SW(Vt=10)\n.model BTN SW(Vt=5)\n.model DMZ8551 D(Is=0.6n Rs=.5 Cjo=150p nbv=5 bv=10 Ibv=1m Vpk=10 type=Zener)
TEXT 496 -768 Left 2 ;Overcurrent Protection\nShunt: 0,1 V / 10 A = 0,01 Ohm, P = 10² A * 0,01 Ohm = 1 W\nDifferential Amp: Ua = (U+ - U-) * R14 / R12 = 3.3 V\nPoti: Ua = 3.25 V
TEXT 96 -192 Left 2 ;over-current simuli: change the value of R18 to < 1.2 Ohm  for (12 V / 1.2 Ohm = 10A)
TEXT 960 -416 Left 2 ;todo: connect the output to the base of Q1?
TEXT 288 -24 Left 2 ;Relay
TEXT -616 -120 Left 2 ;Switch/Button
TEXT -344 -120 Left 2 ;Reverse\nPolarity\nProtection
TEXT 848 -40 Left 2 ;Vbat/Vload optic signal
TEXT 848 208 Left 2 ;Vbat/Vload measurement
TEXT -112 -120 Left 2 ;Deep Discharge Protection
TEXT 312 -992 Left 2 ;todo: this is acting like a voltage divider
LINE Normal -176 -144 -400 -144 1
LINE Normal -176 480 -176 -144 1
LINE Normal -544 480 -176 480 1
LINE Normal -560 480 -544 480 1
LINE Normal -560 144 -560 480 1
LINE Normal -416 144 -560 144 1
LINE Normal -416 -144 -416 144 1
LINE Normal -400 -144 -416 -144 1
RECTANGLE Normal 1296 480 624 176 1
RECTANGLE Normal 1296 -160 -144 -1040 1
RECTANGLE Normal 160 224 480 -48 1
RECTANGLE Normal -432 128 -688 -144 1
RECTANGLE Normal 1296 112 816 -80 1
RECTANGLE Normal 592 480 -144 -144 1
