Version 4
SHEET 1 2260 1148
WIRE 496 -752 464 -752
WIRE 608 -752 576 -752
WIRE 192 -688 192 -720
WIRE 192 -688 64 -688
WIRE 64 -672 64 -688
WIRE 192 -640 192 -688
WIRE 256 -640 192 -640
WIRE 432 -640 336 -640
WIRE 528 -624 528 -656
WIRE 192 -608 192 -640
WIRE 464 -608 464 -752
WIRE 464 -608 384 -608
WIRE 496 -608 464 -608
WIRE -1008 -592 -1008 -608
WIRE -928 -592 -928 -608
WIRE -832 -592 -832 -608
WIRE -736 -592 -736 -608
WIRE 608 -592 608 -752
WIRE 608 -592 560 -592
WIRE 768 -592 608 -592
WIRE 64 -576 64 -592
WIRE 432 -576 432 -640
WIRE 496 -576 432 -576
WIRE 864 -576 832 -576
WIRE 768 -560 736 -560
WIRE 432 -528 432 -576
WIRE 528 -528 528 -560
WIRE 800 -528 800 -544
WIRE 672 -512 672 -528
WIRE -1008 -496 -1008 -512
WIRE -928 -496 -928 -512
WIRE -832 -496 -832 -512
WIRE -736 -496 -736 -512
WIRE 192 -496 192 -528
WIRE 256 -496 192 -496
WIRE 384 -496 384 -608
WIRE 384 -496 336 -496
WIRE 64 -480 64 -512
WIRE 736 -464 736 -560
WIRE 736 -464 704 -464
WIRE 192 -432 192 -496
WIRE 432 -416 432 -448
WIRE 672 -416 672 -432
WIRE 192 -304 192 -352
WIRE 272 -304 192 -304
WIRE 192 -272 192 -304
WIRE 272 -256 272 -304
WIRE 48 -192 32 -192
WIRE 144 -192 128 -192
WIRE 192 -144 192 -176
WIRE 272 -144 272 -192
WIRE 272 -144 192 -144
WIRE 192 -112 192 -144
WIRE -864 16 -1008 16
WIRE -720 16 -864 16
WIRE -624 16 -720 16
WIRE -592 16 -624 16
WIRE -480 16 -512 16
WIRE -384 16 -480 16
WIRE -240 16 -384 16
WIRE -96 16 -240 16
WIRE 48 16 -96 16
WIRE 192 16 48 16
WIRE 336 16 192 16
WIRE 512 16 384 16
WIRE -1008 48 -1008 16
WIRE -864 48 -864 16
WIRE -720 48 -720 16
WIRE -384 48 -384 16
WIRE -240 48 -240 16
WIRE 192 48 192 16
WIRE 48 64 48 16
WIRE 384 64 384 16
WIRE -576 80 -576 64
WIRE -528 80 -528 64
WIRE 336 80 336 16
WIRE 992 80 960 80
WIRE 1104 80 1072 80
WIRE 1248 80 1168 80
WIRE -384 176 -384 128
WIRE -240 176 -240 112
WIRE -240 176 -384 176
WIRE 48 176 48 128
WIRE 192 176 192 128
WIRE 192 176 48 176
WIRE 336 176 336 128
WIRE 336 176 192 176
WIRE 384 176 384 144
WIRE 512 176 384 176
WIRE -1008 192 -1008 128
WIRE -864 192 -864 128
WIRE -720 192 -720 128
WIRE 48 208 48 176
WIRE -240 224 -240 176
WIRE 192 224 192 176
WIRE -96 240 -96 16
WIRE 720 272 688 272
WIRE 848 272 800 272
WIRE 992 272 848 272
WIRE 1136 272 992 272
WIRE 1216 272 1136 272
WIRE -384 288 -384 176
WIRE 0 288 -64 288
WIRE 848 304 848 272
WIRE 992 304 992 272
WIRE 1136 304 1136 272
WIRE -1008 336 -1008 272
WIRE -864 336 -864 272
WIRE -864 336 -1008 336
WIRE -720 336 -720 272
WIRE -720 336 -864 336
WIRE -512 336 -720 336
WIRE -464 336 -512 336
WIRE -320 336 -368 336
WIRE -240 336 -240 288
WIRE -240 336 -320 336
WIRE -96 336 -96 320
WIRE -96 336 -240 336
WIRE 48 336 48 304
WIRE 48 336 -96 336
WIRE 192 336 192 288
WIRE 192 336 48 336
WIRE -1008 368 -1008 336
WIRE -512 416 -512 336
WIRE -448 416 -512 416
WIRE -320 416 -320 336
WIRE -320 416 -384 416
WIRE 848 416 848 384
WIRE 848 416 688 416
WIRE 992 416 992 368
WIRE 992 416 848 416
WIRE 1136 416 1136 368
WIRE 1136 416 992 416
WIRE 688 432 688 416
FLAG -1008 368 0
FLAG 1248 80 0
FLAG -624 16 Vbat+
FLAG -480 16 Vload+
FLAG 960 80 Vload+
FLAG 688 272 Vload+
FLAG 688 432 0
FLAG 1216 272 ADC
FLAG 512 16 Vload+
FLAG 512 176 AP1
FLAG -928 -496 0
FLAG -928 -608 SW
FLAG -576 80 SW
FLAG -528 80 0
FLAG -832 -608 5V
FLAG -832 -496 0
FLAG -736 -608 12V
FLAG -736 -496 0
FLAG 432 -416 0
FLAG 528 -528 0
FLAG 192 -112 0
FLAG -1008 -496 0
FLAG -1008 -608 OC
FLAG 192 -720 12V
FLAG 64 -480 0
FLAG 528 -656 5V
FLAG 800 -608 5V
FLAG 800 -528 0
FLAG 672 -416 0
FLAG 672 -528 5V
FLAG 32 -192 OC
FLAG 864 -576 \OC_INT
SYMBOL Misc\\EuropeanResistor -992 144 R180
WINDOW 0 31 76 Left 2
WINDOW 3 31 40 Left 2
SYMATTR InstName R1
SYMATTR Value 47
SYMBOL Misc\\EuropeanResistor -848 144 R180
WINDOW 0 31 76 Left 2
WINDOW 3 31 40 Left 2
SYMATTR InstName R3
SYMATTR Value 47
SYMBOL Misc\\EuropeanResistor -704 144 R180
WINDOW 0 31 76 Left 2
WINDOW 3 31 40 Left 2
SYMATTR InstName R4
SYMATTR Value 47
SYMBOL sw 384 160 M180
SYMATTR InstName S1
SYMATTR Value DPST
SYMBOL Misc\\EuropeanResistor 976 96 R270
WINDOW 0 27 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName R7
SYMATTR Value 1k
SYMBOL LED 1104 96 R270
WINDOW 0 72 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D1
SYMBOL nmos 0 208 R0
SYMATTR InstName M1
SYMATTR Value IRF3717
SYMBOL diode 208 288 R180
WINDOW 0 -44 31 Left 2
WINDOW 3 -87 -2 Left 2
SYMATTR InstName D2
SYMATTR Value 1N4148
SYMATTR Description Schottky diode
SYMATTR Type schottky
SYMBOL diode 64 128 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D3
SYMATTR Value 1N4148
SYMBOL pot -112 224 R0
SYMATTR InstName X2
SYMATTR SpiceLine R=10k Val=72.5
SYMBOL Misc\\EuropeanResistor 176 32 R0
SYMATTR InstName R6
SYMATTR Value 1k
SYMBOL voltage -720 176 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -193 336 Left 2
SYMATTR Value PULSE(0 12V 1s 1ms 1ms 2s 3s 5)
SYMATTR InstName V1
SYMBOL voltage -864 176 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 244 291 Right 2
SYMATTR Value PULSE(0 12V 1s 1ms 1ms 2s 3s 5)
SYMATTR InstName V2
SYMBOL voltage -1008 176 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -6 245 Left 2
SYMATTR Value PULSE(0 12V 1s 1ms 1ms 2s 3s 5)
SYMATTR InstName V3
SYMBOL nmos -464 288 M90
WINDOW 0 -18 50 VLeft 2
WINDOW 3 72 121 VLeft 2
SYMATTR InstName M2
SYMATTR Value IPB009N03L
SYMBOL Misc\\EuropeanResistor -400 32 R0
SYMATTR InstName R2
SYMATTR Value 12k
SYMBOL zener -224 288 R180
WINDOW 0 24 64 Left 2
WINDOW 3 -50 0 Left 2
SYMATTR InstName D4
SYMATTR Value DMZ8551
SYMBOL cap -256 48 R0
SYMATTR InstName C1
SYMATTR Value 15n
SYMATTR SpiceLine V=50V
SYMBOL Misc\\EuropeanResistor 704 288 R270
WINDOW 0 27 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName R5
SYMATTR Value 100k
SYMBOL Misc\\EuropeanResistor 832 288 R0
SYMATTR InstName R8
SYMATTR Value 27k
SYMBOL cap 976 304 R0
WINDOW 0 -43 22 Left 2
WINDOW 3 -45 60 Left 2
SYMATTR InstName C2
SYMATTR Value 100n
SYMBOL zener 1152 368 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D9
SYMATTR Value DMZ8551
SYMBOL diode -384 400 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D5
SYMATTR Value 1N4148
SYMATTR Description Schottky diode
SYMATTR Type schottky
SYMBOL voltage -928 -608 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -8 218 Left 2
SYMATTR InstName V4
SYMATTR Value PULSE(0V 5.1V 2s 1m 1m 6s 8s 1)
SYMBOL sw -496 16 M270
WINDOW 0 41 29 Left 2
WINDOW 3 39 75 Left 2
SYMATTR InstName S2
SYMATTR Value BTN
SYMBOL voltage -832 -608 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V5
SYMATTR Value 5V
SYMBOL nmos 144 -272 R0
WINDOW 0 -14 2 VRight 2
WINDOW 3 79 -24 VRight 2
SYMATTR InstName M3
SYMATTR Value IPB009N03L
SYMBOL voltage -736 -608 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V6
SYMATTR Value 12V
SYMBOL Misc\\EuropeanResistor 176 -624 R0
SYMATTR InstName R10
SYMATTR Value 0.01
SYMBOL Misc\\EuropeanResistor 240 -624 R270
WINDOW 0 27 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName R11
SYMATTR Value 1k
SYMBOL Misc\\EuropeanResistor 240 -480 R270
WINDOW 0 27 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName R12
SYMATTR Value 1k
SYMBOL Misc\\EuropeanResistor 416 -544 R0
SYMATTR InstName R13
SYMATTR Value 33k
SYMBOL Misc\\EuropeanResistor 480 -736 R270
WINDOW 0 27 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName R14
SYMATTR Value 33k
SYMBOL voltage -1008 -608 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 3 -18 171 Left 2
SYMATTR InstName V7
SYMATTR Value PULSE(0V 5.1V 2s 1m 1m 6s 8s 1)
SYMBOL Misc\\EuropeanResistor 48 -688 R0
SYMATTR InstName R15
SYMATTR Value 1k
SYMBOL LED 48 -576 R0
SYMATTR InstName D6
SYMBOL Opamps\\UniversalOpamp2 528 -592 R0
SYMATTR InstName U1
SYMBOL Misc\\EuropeanResistor 176 -448 R0
SYMATTR InstName R16
SYMATTR Value 1.2883878
SYMBOL Opamps\\UniversalOpamp2 800 -576 R0
SYMATTR InstName U2
SYMBOL pot 656 -528 R0
SYMATTR InstName X1
SYMATTR SpiceLine R=10k Val=35
SYMBOL Misc\\EuropeanResistor 144 -208 R90
WINDOW 0 5 56 VBottom 2
WINDOW 3 27 56 VTop 2
SYMATTR InstName R17
SYMATTR Value 51
SYMBOL diode 288 -192 R180
WINDOW 0 -22 61 Left 2
WINDOW 3 -75 2 Left 2
SYMATTR InstName D7
SYMATTR Value 1N4148
SYMATTR Description Schottky diode
SYMATTR Type schottky
TEXT -1024 -320 Left 2 !.tran 0 15s 0 100m
TEXT -1024 -280 Left 2 !.model DPST SW(Vt=10)\n.model BTN SW(Vt=5)\n.model DMZ8551 D(Is=0.6n Rs=.5 Cjo=150p nbv=5 bv=5.1 Ibv=1m Vpk=5.1 type=Zener)
TEXT 664 -280 Left 2 ;Overcurrent Protection\nShunt: 0,1 V / 10 A = 0,01 Ohm, P = 10² A * 0,01 Ohm = 1 W\nDifferential Amp: Ua = (U+ - U-) * R14 / R12 = 3.3 V\nPoti: Ua = 3.25 V
TEXT -24 -336 Left 2 ;change to x.1xxxxxx for over-current simuli
TEXT 0 -656 VRight 2 ;todo: move signal led
TEXT 1216 -688 Right 2 ;todo: connect the output to the gate of M3?
TEXT 288 -24 Left 2 ;Relay
TEXT -616 -120 Left 2 ;Switch/Button
TEXT -344 -120 Left 2 ;Reverse\nPolarity\nProtection
TEXT 848 -8 Left 2 ;Vbat/Vload optic signal
TEXT 848 208 Left 2 ;Vbat/Vload measurement
LINE Normal -176 -144 -400 -144 1
LINE Normal -176 480 -176 -144 1
LINE Normal -544 480 -176 480 1
LINE Normal -560 480 -544 480 1
LINE Normal -560 144 -560 480 1
LINE Normal -416 144 -560 144 1
LINE Normal -416 -144 -416 144 1
LINE Normal -400 -144 -416 -144 1
RECTANGLE Normal 1296 464 592 176 1
RECTANGLE Normal 1296 -80 -80 -816 1
RECTANGLE Normal 160 224 480 -48 1
RECTANGLE Normal -432 128 -688 -144 1
RECTANGLE Normal 1296 144 816 -48 1
